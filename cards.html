<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="/stylesheets/bootstrap-3.3.7/css/bootstrap.css">
    <link rel='stylesheet' href='/stylesheets/style.css' />

    <script src="/javascripts/jquery-3.2.1.slim.min.js"></script>
</head>

<body>
    <div class="container">
        <h1 class="center">It's time O'Clock to make a MEMORY !</h1>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card0_0" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card0_1" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card0_2" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card0_3" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card0_4" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card0_5" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card0_6" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card1_0" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card1_1" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card1_2" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card1_3" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card1_4" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card1_5" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card1_6" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ***************************************************** 3è ligne ******************************************-->
        <div class="row">
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card2_0" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card2_1" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card2_2" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card2_3" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card2_4" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card2_5" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card2_6" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ***************************************************** 4è ligne ******************************************-->
        <div class="row">
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card3_0" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card3_1" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card3_2" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card3_3" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card3_4" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card3_5" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-1 square">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front"><canvas id="card3_6" height="100" width="100"></canvas></div>
                        <div class="flip-card-back"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="visibility:hidden"><img id="cards" src="images/cards.png" /></div>
    <script>
        window.onload = function (event) {
            var grilleJeu = shuffle([0,1,2,3,4,5,6,7,8,9,10,11,12,13,0,1,2,3,4,5,6,7,8,9,10,11,12,13]);
            var indiceFruit = 0;
            var XSource = 0, YSource = 0, XDest = 0, YDest = 0, i = 0, j = 0;
            var canevas = null, context = null;
            // récupération des images de fruits
            function loadAndDrawImage(url) {
                // Create an image object. This is not attached to the DOM and is not part of the page.
                var image = new Image();
                // Now set the source of the image that we want to load
                image.src = url;
                // When the image has loaded, draw it to the canvas
                image.onload = function () {
                    for (let i = 0; i < 4; i++) {
                        for (let j = 0; j < 7; j++) {
                            canevas = document.getElementById('card' + i + '_' + j);
                            context = canevas.getContext("2d");
                            context.drawImage(image, XSource, grilleJeu[indiceFruit]*100, 100, 100, XDest, YDest, 100, 100);
                            indiceFruit += 1;
                            var clicked = document.getElementById('card' + i + '_' + j);
                            clicked.parentElement.parentElement.addEventListener('click', function (evt) {
                                if (evt.target.localName == "canvas") {
                                    evt.target.parentElement.parentElement.classList.toggle('flip-action');
                                }
                                else evt.target.parentElement.classList.toggle('flip-action');
                            });
                        }
                    }
                    console.log("grilleJeu : ", grilleJeu);
                }
            }
            loadAndDrawImage("images/cards.png");

            setTimeout(returnCards, 3000);   // memorisation pendant trois seconde

            function returnCards() {
                var cards = document.getElementsByClassName("flip-card-inner");
                console.log('cards : ', cards);
                for (let i = 0; i < cards.length; i++) {
                    cards[i].classList.toggle('flip-action');
                }
            }

            function shuffle(array) {
                var copy = [], n = array.length, i;

                // While there remain elements to shuffle…
                while (n) {

                    // Pick a remaining element…
                    i = Math.floor(Math.random() * array.length);

                    // If not already shuffled, move it to the new array.
                    if (i in array) {
                        copy.push(array[i]);
                        delete array[i];
                        n--;
                    }
                }

                return copy;
            }
        }
    </script>
</body>

</html>